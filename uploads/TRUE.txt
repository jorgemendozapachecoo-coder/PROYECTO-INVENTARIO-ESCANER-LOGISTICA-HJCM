
Option Explicit

Private Sub CommandButton1_Click()

    Dim strDescripcion As String
    Dim intCantidad As Double
    Dim doublePUnitario As Integer
    Dim intTotal As Double

    On Error GoTo ErrorHandler

    With Application.WorksheetFunction

        strDescripcion = .VLookup(CDbl(Me.TextBox1.Value), PRODUCTOS.Range("A:C"), 2, 0)

        intCantidad = InputBox(strDescripcion & vbNewLine & vbNewLine & "Ingresa la cantidad.", "Cantidad", 1)

        If intCantidad = 0 Then GoTo ErrorHandler

        Me.ListBox1.AddItem Me.TextBox1.Value
        ListBox1.List(ListBox1.ListCount - 1, 1) = strDescripcion
        ListBox1.List(ListBox1.ListCount - 1, 2) = .Text(intCantidad, "#,##0")

        doublePUnitario = .VLookup(CDbl(Me.TextBox1.Value), PRODUCTOS.Range("A:C"), 3, 0)
        ListBox1.List(ListBox1.ListCount - 1, 3) = .Text(doublePUnitario, "#,##0.00")

        intTotal = doublePUnitario * intCantidad
        ListBox1.List(ListBox1.ListCount - 1, 4) = .Text(intTotal, "#,##0.00")


        Me.lblProductos = .Text(CInt(Me.lblProductos) + CInt(intCantidad), "#,##0")
        Me.lblTotal = .Text(CDbl(Me.lblTotal) + CDbl(intTotal), "#,##0.00")

        Me.TextBox1.Value = ""
        Me.TextBox1.SetFocus
    End With

    Exit Sub

ErrorHandler:
    MsgBox "Ha ocurrido un error: " & Err.Description, vbExclamation, "EXCELeINFO"
    Me.TextBox1.Value = ""
    Me.TextBox1.SetFocus
End Sub

Private Sub CommandButton4_Click()
    Unload Me
End Sub

Private Sub CommandButton5_Click()

    Dim i As Variant
    Dim j As Variant
    Dim TransRowRng As Range
    Dim NewRow As Integer

    On Error GoTo ErrorHandler

    With ThisWorkbook.Worksheets("PRODUCTOS ACTUALIZADOS")
        For i = Me.ListBox1.ListCount To 1 Step -1
            Set TransRowRng = .Cells(1, 1).CurrentRegion
            NewRow = TransRowRng.Rows.Count + 1
            .Cells(NewRow, 1).Value = Date
            .Cells(NewRow, 2).Value = Me.txtConsec.Value

            For j = 0 To 4
                .Cells(NewRow, j + 3).Value = Me.ListBox1.List(Me.ListBox1.ListCount - i, j)
            Next j
        Next i
    End With

    MsgBox "Registros guardados con Ã©xito.", vbInformation, "EXCELeINFO"
    Unload Me

    Exit Sub

ErrorHandler:
    MsgBox "Error al guardar los registros: " & Err.Description, vbExclamation, "ERROR"
End Sub

Private Sub CommandButton6_Click()

    Dim Cuenta As Integer
    Dim Numero As Integer
    Dim j As Integer
    Dim i As Integer
    Dim strNombreItem As String
    Dim CantidadSeleccionado As String
    Dim TotalSeleccionado As Double

    Cuenta = Me.ListBox1.ListCount
    Numero = 0

    For j = 0 To Cuenta - 1
        If Me.ListBox1.Selected(j) = True Then
            Numero = Numero + 1
        End If
    Next j

    If Numero <> 0 Then

        For i = 0 To Cuenta - 1
            If Me.ListBox1.Selected(i) = True Then
                strNombreItem = Me.ListBox1.List(i)
                CantidadSeleccionado = ListBox1.List(i, 2)
                TotalSeleccionado = ListBox1.List(i, 4)
                Me.ListBox1.RemoveItem i
                Me.lblProductos.Caption = WorksheetFunction.Text(Me.lblProductos.Caption - CantidadSeleccionado, "#,##0")
                Me.lblTotal.Caption = WorksheetFunction.Text(Me.lblTotal.Caption - TotalSeleccionado, "#,##0.00")
            End If
        Next i
    End If
End Sub

Private Sub Frame1_Click()
End Sub

Private Sub ListBox1_Click()
End Sub

Private Sub UserForm_Initialize()
    Dim intConsecutivo As String

    Me.ListBox1.ColumnCount = 5
    Me.ListBox1.ColumnWidths = "70 pt; 150 pt; 55 pt; 60 pt; 60 pt"
    Me.txtFecha.Value = Date

    intConsecutivo = VENTAS.Range("I1").Value

    If intConsecutivo = "CONSECUTIVO" Then
        Me.txtConsec = 1
    Else
        Me.txtConsec = intConsecutivo + 1
    End If
End Sub







Private Sub CommandButton1_Click()
frmVenta.Show vbModal = False
End Sub
